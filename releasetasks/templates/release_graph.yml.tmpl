---
metadata:
    name: "Release Promotion"
    description: "Release Promotion"
    owner: "release@mozilla.com"
    source: "https://github.com/rail/releasetasks"

scopes:
  - signing:format:gpg
  - queue:define-task:buildbot-bridge/buildbot-bridge
  - queue:create-task:buildbot-bridge/buildbot-bridge
  - queue:task-priority:high
{% if source_enabled %}
  - docker-worker:cache:tc-vcs
  - docker-worker:image:taskcluster/builder:*
  - queue:define-task:aws-provisioner-v1/build-c4-2xlarge
  - queue:create-task:aws-provisioner-v1/build-c4-2xlarge
  - docker-worker:cache:build-linux64-workspace
  - docker-worker:cache:tooltool-cache
{% endif %}
{% if updates_enabled %}
  - queue:*
  - docker-worker:*
  - scheduler:*
  - signing:format:mar
  - signing:cert:{{ signing_class }}
{# dep signing uses Balrog dev environment, which is publicly available and
   this doesn't need to use the proxy
#}
{% if signing_class != "dep-signing" %}
  - docker-worker:feature:balrogVPNProxy
{% endif %}
{% endif %}

tasks:
    {% if source_enabled %}
    {% macro source_tasks() %}{% include "source.yml.tmpl" %}{% endmacro %}
    {{ source_tasks()|indent(4) }}
    {% endif %}

# {# Commented out until buildbot builders exist
#    {% macro l10n_tasks() %}{% include "l10n.yml.tmpl" %}{% endmacro %}
#    {{ l10n_tasks()|indent(4) }} #}

    {% if updates_enabled %}
    {% for platform in enUS_platforms %}
    {% set locale = "en-US" %}
    {% macro funsize_tasks() %}{% include "funsize.yml.tmpl" %}{% endmacro %}
    {{ funsize_tasks()|indent(4) }}
    {% endfor %}
    {% endif %}
