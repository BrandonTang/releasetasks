{% for platform in l10n_platforms %}
{% for chunk in range(1, l10n_chunks+1) %}
{% set buildername = "{}_repack_{}/{}".format(platform, chunk, l10n_chunks) %}
-
    taskId: "{{ stable_slug_id(buildername) }}"
    reruns: 5
    task:
        provisionerId: "buildbot-bridge"
        workerType: "buildbot-bridge"
        created: "{{ now }}"
        deadline: "{{ now.replace(hours=36) }}"
        expires: {{ never }}"
        priority: "high"
        retries: 5
        
        payload:
            buildername: "{{ buildername }}"
            sourcestamp:
                branch: "{{ repo_path }}"
                revision: "{{ revision }}"
            properties:
                # TODO: Only put revisions needed by the chunk in here?
                # Could cause problems if the thing interpreting this
                # template and the mozharness script choose different
                # locales
                {% for locale, locale_revision in l10n_changesets.iteritems() %}
                {{ locale }}_revision: {{ locale_revision }}
                {% endfor %}

        metadata:
            name: "{{ product }} {{ branch }} {{ platform }} l10n repack {{ chunk }}/{{ l10n_chunks }}"

{% endfor %}
{% endfor %}
