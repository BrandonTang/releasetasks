{% for platform in l10n_platforms %}
# TODO: iterate over platform specific locales...probably need l10n json to do this
{% for locale, locale_revision in l10n_changesets.iteritems() %}
# TODO: make a helper function to generate consistent builder names?
{% set buildername = "{}_{}_{}_l10n_repack".format(branch, product, platform) %}
-
    taskId: "{{ stable_slug_id(buildername) }}"
    reruns: 5
    task:
        provisionerId: "buildbot-bridge"
        workerType: "buildbot-bridge"
        created: "{{ now }}"
        deadline: "{{ now.replace(hours=36) }}"
        expires: {{ never }}"
        priority: "high"
        retries: 5

        payload:
            buildername: "{{ buildername }}"
            sourcestamp:
                branch: "{{ repo_path }}"
                revision: "{{ revision }}"
            properties:
                extra_args: "--locale {{ '{}:{} '.format(locale, locale_revision)}}"

        metadata:
            name: "{{ product }} {{ branch }} {{ platform }} {{ locale }} l10n repack"

{% endfor %}
{% endfor %}

# TODO: include funsize
